<div><div plug="layout"><div class="pdl-layout"><div data-type="layout"><div class="pdl-cell" data-name="view"></div><div class="pdl-cell" data-name="legend"></div></div><div data-type="render"></div></div></div><style type="text/css">.pdl-layout>div[data-type=layout]{display:flex;justify-content:center;align-items:center}.pdl-layout>div[data-type=layout] [data-name=view]{height:100%;margin-right:1em}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"curve-bar",version:"0.0.1",extend:{name:"base",version:"0.0.1"},dependencies:[]},init:function(t){var e,n,r;e=t.root,n=t.context,r=t.pubsub;return r.fire("init",{mod:mod({context:n})})}};mod=function(t){var e,s,n,r;e=t.context;s=e.d3,n=e.legend,r=e.chart;return{sample:function(){return{raw:[1,2,3,4,5].map(function(t){return{val:(10*Math.random()).toFixed(1),name:"N"+t}}),binding:{name:{key:"name"},value:{key:"val"}}}},config:{palette:{type:"palette"},sort:{type:"choice",values:["asc","desc","none"],default:"desc"},curve:{padding:{type:"number",default:.1,min:0,max:1,step:.01},hole:{type:"number",default:.5,min:0,max:1,step:.01}}},dimension:{value:{type:"R",name:"value"},name:{type:"N",name:"name"}},init:function(){var e;this.gview=s.select(this.layout.getGroup("view"));this.g=this.gview.append("g");this.tint=e=new r.utils.tint;this.parsed=[];this.arc=s.arc().innerRadius(0).outerRadius(100).startAngle(0).endAngle(Math.PI/2);return this.legend=new r.utils.legend({root:this.root,name:"legend",shape:function(t){return s.select(this).attr("fill",e.get(t.text))},layout:this.layout})},parse:function(){var a=this;this.tint.reset();this.parsed=this.data.map(function(t,e){var n,r;n=import$({_i:e},t);if(!(r=a.parsed.filter(function(t){return t._i===e})[0])){return n}n.cur=r.cur;n.old=r.old;return n});this.extent={v:s.extent(this.parsed.map(function(t){return t.value}))};return this.legend.data(this.parsed.map(function(t){return{key:t.name,text:t.name}}))},resize:function(){var t,e,n,r,a,i=this;t=this.layout.getBox("view");this.parsed.sort(function(t,e){if(i.cfg.sort==="asc"){return e.value-t.value}else if(i.cfg.sort==="desc"){return t.value-e.value}else{return t._idx-e._idx}});this.layout.getNode("view").style.width=t.height+"px";this.layout.update(false);e=[t.width,t.height],n=e[0],r=e[1];a=Math.min(n,r);return this.scale={v:s.scaleLinear().domain([0,this.extent.v[1]]).range([0,Math.PI*3/2]),r:s.scaleBand().domain(this.parsed.map(function(t,e){return e})).range([this.cfg.curve.hole*a/2,a/2])}},render:function(){var n,r,a,t,e,i,s=this;n=this.scale;r=this.scale.r.bandwidth();this.arc.cornerRadius(r/2);if(this.cfg!=null&&this.cfg.palette){this.tint.set(this.cfg.palette.colors.map(function(t){return t.value||t}))}this.legend.render();this.parsed.map(function(t,e){t.old=t.cur||{a:0,ri:n.r(e)+r/2,ro:n.r(e)+r/2};return t.cur={a:n.v(t.value),ri:n.r(e)+r/2-r/2*(1-s.cfg.curve.padding),ro:n.r(e)+r/2+r/2*(1-s.cfg.curve.padding)}});a=function(e,n,t){return function(t){s.arc.startAngle(0).endAngle((n.a-e.a)*t+e.a).innerRadius((n.ri-e.ri)*t+e.ri).outerRadius((n.ro-e.ro)*t+e.ro);return s.arc()}};t=this.layout.getBox("view");this.g.attr("transform","translate("+t.width/2+","+t.height/2+")");e=this.g.selectAll("path.data").data(this.parsed,function(t){return t._idx});e.exit().remove();e.enter().append("path").attr("class","data");this.g.selectAll("path.data").transition().duration(350).attrTween("d",function(t,e){return a(t.old,t.cur,e)}).attr("fill",function(t,e){return s.tint.get(t.name)||t._idx});i=this.g.selectAll("text.label").data(this.parsed);i.exit().remove();i.enter().append("text").attr("class","label").attr("y",function(t,e){return-n.r(e)}).attr("dy",-r*1/4);return this.g.selectAll("text.label").attr("dominant-baseline","center").attr("text-anchor","end").attr("x","-.5em").text(function(t,e){return t.name}).transition().duration(350).attr("y",function(t,e){return-n.r(e)}).attr("dy",-r*1/4)}}};function import$(t,e){var n={}.hasOwnProperty;for(var r in e)if(n.call(e,r))t[r]=e[r];return t}</script></div>