<div><div plug="layout"><div class="pdl-layout"><div data-type="layout"><div class="pdl-cell" data-name="view"></div><div class="pdl-cell" data-name="legend">&nbsp;</div></div><div data-type="render"></div></div></div><style type="text/css">.pdl-layout>div[data-type=layout]{display:grid;grid-template-columns:1fr fit-content(10em);grid-template-rows:1fr;padding:0 .5em}.pdl-layout>div[data-type=layout]>.pdl-cell[data-name=legend]{grid-column:2;grid-row:1/span 1;padding-left:1em}.pdl-layout.legend-below>div[data-type=layout]{grid-template-columns:1fr;grid-template-rows:1fr fit-content(3em)}.pdl-layout.legend-below>div[data-type=layout] .pdl-cell[data-name=legend]{padding-top:1em;grid-column:1/span 1;grid-row:2}</style><script type="@plotdb/block">var sampleIcon,mod;sampleIcon="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDBweCIgaGVpZ2h0PSIyMDBweCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHN0eWxlPSJ3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2JhY2tncm91bmQtc2l6ZTppbml0aWFsO2JhY2tncm91bmQtcmVwZWF0LXk6aW5pdGlhbDtiYWNrZ3JvdW5kLXJlcGVhdC14OmluaXRpYWw7YmFja2dyb3VuZC1wb3NpdGlvbi15OmluaXRpYWw7YmFja2dyb3VuZC1wb3NpdGlvbi14OmluaXRpYWw7YmFja2dyb3VuZC1vcmlnaW46aW5pdGlhbDtiYWNrZ3JvdW5kLWNvbG9yOmluaXRpYWw7YmFja2dyb3VuZC1jbGlwOmluaXRpYWw7YmFja2dyb3VuZC1hdHRhY2htZW50OmluaXRpYWw7YW5pbWF0aW9uLXBsYXktc3RhdGU6cGF1c2VkIiA+PGcgY2xhc3M9ImxkbC1zY2FsZSIgc3R5bGU9InRyYW5zZm9ybS1vcmlnaW46NTAlIDUwJTt0cmFuc2Zvcm06cm90YXRlKDBkZWcpIHNjYWxlKDEsIDEpO2FuaW1hdGlvbi1wbGF5LXN0YXRlOnBhdXNlZCIgPjxjaXJjbGUgZmlsbD0iIzg0OWI4NyIgcj0iMTAuODc2IiBjeT0iMTUuODc2IiBjeD0iNTAiIHN0eWxlPSJmaWxsOnJnYigyOSwgMTQsIDExKTthbmltYXRpb24tcGxheS1zdGF0ZTpwYXVzZWQiID48L2NpcmNsZT4KPGcgc3R5bGU9ImFuaW1hdGlvbi1wbGF5LXN0YXRlOnBhdXNlZCIgPjxwYXRoIGZpbGw9IiM4NDliODciIGQ9Ik02OC43NjQgNTguNjM1YTMuOTg1IDMuOTg1IDAgMCAxLTMuOTg1LTMuOTg1di02LjY0MmMwLTguMTQ5LTYuNjMtMTQuNzc5LTE0Ljc3OS0xNC43NzlzLTE0Ljc3OSA2LjYzLTE0Ljc3OSAxNC43Nzl2Ni42NDJhMy45ODUgMy45ODUgMCAxIDEtNy45NyAwdi02LjY0MmMwLTEyLjU0NCAxMC4yMDUtMjIuNzQ5IDIyLjc0OS0yMi43NDlzMjIuNzQ5IDEwLjIwNSAyMi43NDkgMjIuNzQ5djYuNjQyYzAgMi4yLTEuNzg0IDMuOTg1LTMuOTg1IDMuOTg1eiIgc3R5bGU9ImZpbGw6cmdiKDI5LCAxNCwgMTEpO2FuaW1hdGlvbi1wbGF5LXN0YXRlOnBhdXNlZCIgPjwvcGF0aD48L2c+CjxwYXRoIGQ9Ik0zOC40MTcgMzIuMTY3aDIzLjE2N3YzMy42NjdIMzguNDE3eiIgZmlsbD0iIzg0OWI4NyIgc3R5bGU9ImZpbGw6cmdiKDI5LCAxNCwgMTEpO2FuaW1hdGlvbi1wbGF5LXN0YXRlOnBhdXNlZCIgPjwvcGF0aD4KPHBhdGggZmlsbD0iIzg0OWI4NyIgZD0iTTQzLjM5OSA1My40ODdhNC45NCA0Ljk0IDAgMCAwLTQuOTQgNC45NFY5MC4wNmE0Ljk0IDQuOTQgMCAwIDAgOS44OCAwVjU4LjQyN2E0Ljk0IDQuOTQgMCAwIDAtNC45NC00Ljk0eiIgc3R5bGU9ImZpbGw6cmdiKDI5LCAxNCwgMTEpO2FuaW1hdGlvbi1wbGF5LXN0YXRlOnBhdXNlZCIgPjwvcGF0aD4KPHBhdGggZmlsbD0iIzg0OWI4NyIgZD0iTTU2LjYwMSA1My40ODdhNC45NCA0Ljk0IDAgMCAxIDQuOTQgNC45NFY5MC4wNmE0Ljk0IDQuOTQgMCAwIDEtOS44OCAwVjU4LjQyN2E0Ljk0IDQuOTQgMCAwIDEgNC45NC00Ljk0eiIgc3R5bGU9ImZpbGw6cmdiKDI5LCAxNCwgMTEpO2FuaW1hdGlvbi1wbGF5LXN0YXRlOnBhdXNlZCIgPjwvcGF0aD4KPG1ldGFkYXRhIHhtbG5zOmQ9Imh0dHBzOi8vbG9hZGluZy5pby9zdG9jay8iIHN0eWxlPSJhbmltYXRpb24tcGxheS1zdGF0ZTpwYXVzZWQiID48ZDpuYW1lIHN0eWxlPSJhbmltYXRpb24tcGxheS1zdGF0ZTpwYXVzZWQiID5tYW48L2Q6bmFtZT4KCgo8ZDp0YWdzIHN0eWxlPSJhbmltYXRpb24tcGxheS1zdGF0ZTpwYXVzZWQiID5tYW4scGVvcGxlLGNoYXJhY3RlcixwZXJzb24sZmlndXJlLGlkb2wsZG9sbDwvZDp0YWdzPgoKCjxkOmxpY2Vuc2Ugc3R5bGU9ImFuaW1hdGlvbi1wbGF5LXN0YXRlOnBhdXNlZCIgPmJ5PC9kOmxpY2Vuc2U+CgoKPGQ6c2x1ZyBzdHlsZT0iYW5pbWF0aW9uLXBsYXktc3RhdGU6cGF1c2VkIiA+bXE1dXg8L2Q6c2x1Zz48L21ldGFkYXRhPjwvZz48IS0tIGdlbmVyYXRlZCBieSBodHRwczovL2xvYWRpbmcuaW8vIC0tPjwvc3ZnPg==";module.exports={pkg:{name:"pictogram",version:"0.0.1",extend:{name:"base",version:"0.0.1"},dependencies:[{name:"ldfile",version:"main",path:"index.min.js"}],i18n:{}},init:function(t){var e,i,a,n;e=t.root,i=t.ctx,a=t.t,n=t.pubsub;return n.fire("init",{mod:mod({ctx:i,t:a})})}};mod=function(t){var e,i,a,m,n,o;e=t.ctx,i=t.t;a=e.chart,m=e.d3,n=e.debounce,o=e.ldfile;return{sample:function(){return{raw:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100].map(function(t){return{name:"N-"+t,cat:Math.round(Math.random()*3)}}),binding:{cat:{key:"cat"},name:{key:"name"}}}},config:{palette:{type:"palette"},shape:{type:"upload"},padding:{type:"number",default:0,min:0,max:1,step:.01}},dimension:{value:{type:"R"},name:{type:"N"}},init:function(){var e,i=this;this.tint=e=new a.utils.tint;this.g=Object.fromEntries(["view","legend"].map(function(t){return[t,m.select(i.layout.getGroup(t))]}));this.g.defs=m.select(this.svg).append("g").attr("class","defs");this.legend=new a.utils.legend({layout:this.layout,name:"legend",root:this.root,shape:function(t){return m.select(this).attr("fill",e.get(t.key))}});return this.legend.on("select",function(){i.parse();i.bind();i.resize();return i.render()})},destroy:function(){if(this.tip){return this.tip.destroy()}},parse:function(){var i,t,e,a,n=this;i={};this.data.map(function(t){return i[t.cat]=(i[t.cat]||0)+1});t=[];for(e in i){a=i[e];t.push(e)}this.cats=t;this.legend.data(this.cats.map(function(t){return{key:t,text:t}}));this.parsed=this.data.map(function(t){return t}).filter(function(t){return n.legend.isSelected(t.cat)});this.parsed.map(function(t){return t._removing=false});this.parsed.sort(function(t,e){if(i[t.cat]<i[e.cat]){return 1}else if(i[t.cat]>i[e.cat]){return-1}return t.cat<e.cat?-1:t.cat>e.cat?1:0});this.parsed.map(function(t,e){return t._order=e});return this.sum=this.parsed.length},resize:function(){this.legend.config(this.cfg.legend);this.legend.update();this.layout.update(false);return this.tint.set(this.cfg.palette.colors.map(function(t){return t.value||t}))},render:function(){var a,c,t,e,i,d,n,s,u,r,l,h,g=this;a=this.tint,c=this.cfg;t=Math.round(Math.sqrt(this.sum));e=[t||1,Math.ceil(this.sum/t)||1],i=e[0],d=e[1];n=this.layout.getBox("view");e=[n.width/d,n.height/i],s=e[0],u=e[1];r=this.g.view.selectAll("g.data").data(this.parsed,function(t){return t._idx});r.exit().each(function(t,e){t._removing=true;return m.select(this).select("rect.data").transition().duration(150).attr("x",s/2).attr("y",s/2).attr("width",0).attr("height",0)});r.exit().transition().delay(150).remove();r.enter().append("g").attr("class","data").attr("transform",function(t,e){var i,a,n,r;i=t._order;a=[s*(i%d),u*Math.floor(i/d)],n=a[0],r=a[1];return"translate("+n+", "+r+")"}).append("rect").attr("class","data").attr("opacity",0).attr("x",s/2).attr("y",u/2).attr("width",0).attr("height",0);this.g.view.selectAll("g.data").transition().duration(350).attr("transform",function(t,e){var i,a,n,r,l;i=c.padding||0;a=t._order;n=[s*(a%d),u*Math.floor(a/d)],r=n[0],l=n[1];n=[r+s*i/2,l+u*i/2],r=n[0],l=n[1];return"translate("+r+", "+l+")"});this.g.view.selectAll("g.data").each(function(t,e){var i;if(t._removing){return}i=c.padding||0;return m.select(this).select("rect.data").attr("fill",function(t,e){return a.get(t.cat)}).transition().duration(350).attr("opacity",1).attr("x",0).attr("y",0).attr("width",s*(1-i)).attr("height",u*(1-i)).attr("mask","url(#mymask)")});l="";h=this.cfg.shape&&this.cfg.shape[0]?o.fromFile(this.cfg.shape[0],"dataurl").then(function(t){var e;return e=t.result}):Promise.resolve(sampleIcon);h.then(function(t){var e,i;e=c.padding||0;i='<image xlink:href="'+t+'" width="'+s*(1-e)+'" height="'+u*(1-e)+'" filter="url(#fill)"/>';return g.svg.querySelector("g.defs").innerHTML='<defs>\n  <filter id="fill"><feColorMatrix in="SourceGraphic" type="matrix"\n  values="0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0"/></filter>\n  <mask id="mymask">'+i+"</mask>\n</defs>"});return this.legend.render()}}};</script></div>