<div><div plug="layout"><div class="pdl-layout"><div data-type="layout"><div class="pdl-cell" data-name="view"></div><div class="pdl-cell" data-name="link"></div><div class="pdl-cell" data-name="legend"></div></div><div data-type="render"></div></div></div><style type="text/css">.pdl-layout>div[data-type=layout]{display:flex;justify-content:center;align-items:center;padding:.5em}.pdl-layout>div[data-type=layout]>[data-name=view]{height:100%;min-width:2.5em;margin-right:.5em;flex:1 0 2.5em}.pdl-layout>div[data-type=layout]>[data-name=link]{height:100%;width:2.5em;margin-right:.5em;flex:0 0 auto}.pdl-layout>div[data-type=layout]>[data-name=legend]{flex:1 0 auto;width:fit-content;max-width:60%;height:100%;display:flex;flex-direction:column;justify-content:start;align-items:start}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"percent-list",version:"0.0.1",extend:{name:"base",version:"0.0.1"},dependencies:[],i18n:{"zh-TW":{other:"其它"}}},init:function(t){var e,i,a,n;e=t.root,i=t.context,a=t.pubsub,n=t.t;return a.fire("init",{mod:mod({context:i,t:n})})}};mod=function(t){var e,d,a,n,x,r;e=t.context,d=t.t;a=e.chart,n=e.d3,x=e.wrapSvgText,r=e.debounce;return{sample:function(){return{raw:["Bachchan Pandey","The Good Maharaja","Ramprasad Ki Tehrvi","Madam Chief Minister","Satya Sai Baba","Lahore Confidential","Sandeep Aur Pinky Faraar","Silence... Can You Hear It?","Hum Bhi Akele Tum Bhi Akele","Radhe","Shaadisthan","Chandigarh Kare Aashiqui","Gangubai Kathiawadi","Attack","The Battle of Bhima Koregaon","Tadap","Looop Lapeta"].map(function(t){return{val:Math.random(),name:t}}),binding:{name:{key:"name"},value:{key:"val"}}}},config:a.utils.config.from({preset:"default",label:"label"}),dimension:{value:{type:"R",name:"value",priority:20},name:{type:"N",name:"name",priority:10}},init:function(){var t,i=this;this.g={view:n.select(this.layout.getGroup("view")),link:n.select(this.layout.getGroup("link")),legend:n.select(this.layout.getGroup("legend"))};this.tint=t=new a.utils.tint;this.scale={y:n.scaleLinear()};this.layout.getGroup("view").addEventListener("mousemove",function(t){var e;if(!((e=t.target)&&e.nodeName.toLowerCase()==="rect")){return}i.idx=Array.from(e.parentNode.childNodes).indexOf(e);return i.renderDebounced()});return this.renderDebounced=r(350,function(){return i.render()})},parse:function(){var t,e,i,a,n,r,s,o,l,h,u=this;((t=this.cfg).collapse||(t.collapse={})).enabled=false;this.parsed=this.data.map(function(t){return import$({},t)});this.parsed.sort(function(t,e){return e.value-t.value});if(this.cfg.collapse.enabled){if(this.cfg.collapse.method==="count"){e=this.parsed.splice(this.cfg.collapse.threshold||7);if(e.length){this.parsed.push({name:d("other"),value:e.reduce(function(t,e){return t+e.value},0)})}}else{t=[this.parsed.reduce(function(t,e){return t+e.value},0),0],i=t[0],a=t[1];for(n=0,r=this.parsed.length;n<r;++n){s=n;a+=this.parsed[s].value;if(a/i>(this.cfg.collapse.threshold||.75)){break}}e=this.parsed.splice(s+1);if(e.length){this.parsed.push({name:d("other"),value:e.reduce(function(t,e){return t+e.value},0)})}}}this.tint.reset();this.parsed.map(function(t){return u.tint.get(t.name||t._idx)});o=0;for(n=0,r=this.parsed.length;n<r;++n){l=n;h=this.parsed[l];h.offset=o;o+=h.value}return this.total=o||1},resize:function(){var a,t,e,i,n,r,s=this;this.layout.update(false);a=this.layout.getNode("legend");a.textContent="";this.parsed.map(function(t){var e,i;e=document.createElement("div");i=(100*(t.value/s.total)).toFixed(1);e.textContent=t.text=t.name+" / "+i+"%";return a.appendChild(e)});this.nboxes=this.parsed.map(function(t,e){return s.layout.getNode("legend").childNodes[e].getBoundingClientRect()});this.rbox=this.layout.getNode("legend").getBoundingClientRect();this.lbox=this.layout.getBox("link");t=this.layout.getBox("view");this.layout.update(false);t=this.layout.getBox("view");e=[t.width,t.height],i=e[0],n=e[1];r=Math.min(i,n);this.scale.y.range([0,t.height]).domain([0,this.total]);return this.resized=true},render:function(){var r,s,n,o,h,u,d,c,l,t,f,e,i,a,g,p,v,y,m;r=this.total,s=this.cfg,n=this.layout,o=this.tint,h=this.scale,u=this.nboxes,d=this.rbox,c=this.lbox,l=this.resized;if(this.cfg!=null&&this.cfg.palette){this.tint.set(this.cfg.palette.colors.map(function(t){return t.value||t}))}t=this.layout.getBox("view");f=0;if(this.idx!=null&&u.length){this.idx=(e=(i=this.idx)<(a=this.nboxes.length-1)?i:a)>0?e:0;f=u[this.idx].y-d.y;g=u[u.length-1].y+u[u.length-1].height-d.y;if(g-f<d.height){f=g-d.height}}p=this.g.view.selectAll("rect.data").data(this.parsed);p.exit().remove();p.enter().append("rect").attr("class","data");v=this.g.view.selectAll("rect.data");v.attr("x",function(){return 0});v.attr("y",function(t,e){return h.y(t.offset)});v.attr("width",function(){return t.width});v.attr("height",function(t,e){var i;return(i=h.y(t.offset+t.value)-h.y(t.offset)-1)>1?i:1});v.attr("fill",function(t,e){var i,a,n;return o.get(Math.ceil((t.offset+t.value/2)/r*5));i=o.get(0,(e%3-1)/5);if(s.collapse.enabled){a=u[e];n=a.y-d.y+a.height/2;if(n<d.height){return i}i=ldcolor.hcl(i);i.c=i.c*.1;i.l=i.l*1.1}return ldcolor.web(i)});y=this.g.legend.selectAll("g.label").data(this.parsed);y.exit().remove();y.enter().append("g").attr("class","label");this.g.legend.selectAll("g.label").each(function(t,e){var i,a;if(l||this._text!==t.text){this._text=t.text;i=n.getNode("legend").childNodes[e];a=x({node:i,useRange:true});this.textContent="";return this.appendChild(a)}}).transition().duration(350).attr("opacity",function(t,e){var i,a;i=u[e];a=i.y-d.y-f;if(a<0||a>d.height-i.height/2){return 0}else{return 1}}).attr("transform",function(t,e){var i;i=u[e];return"translate("+(i.x-d.x)+", "+(i.y-d.y-f)+")"});m=this.g.link.selectAll("path").data(this.parsed);m.exit().remove();m.enter().append("path").attr("fill","none").attr("stroke-width",1);this.g.link.selectAll("path").attr("stroke",function(t,e){return o.get(Math.ceil((t.offset+t.value/2)/r*5))}).transition().duration(350).attr("d",function(t,e){var i,a,n,r,s,o,l;i=0;a=c.width/10;n=9*c.width/10;r=c.width;s=h.y(t.offset+t.value/2);o=u[e];l=o.y-d.y+o.height/2-f;if(Math.abs(l-s)<2){l=s}return"M"+i+" "+s+" L"+a+" "+s+" L"+n+" "+l+" L"+r+" "+l}).attr("opacity",function(t,e){var i,a,n;i=u[e];a=h.y(t.offset+t.value/2);n=i.y-d.y+i.height/2-f;if(Math.abs(n-a)<2){n=a}return n>d.height||n<0?0:1});return this.resized=false}}};function import$(t,e){var i={}.hasOwnProperty;for(var a in e)if(i.call(e,a))t[a]=e[a];return t}</script></div>