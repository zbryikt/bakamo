 (function() { function pug_attr(t,e,n,r){if(!1===e||null==e||!e&&("class"===t||"style"===t))return"";if(!0===e)return" "+(r?t:t+'="'+t+'"');var f=typeof e;return"object"!==f&&"function"!==f||"function"!=typeof e.toJSON||(e=e.toJSON()),"string"==typeof e||(e=JSON.stringify(e),n||-1===e.indexOf('"'))?(n&&(e=pug_escape(e))," "+t+'="'+e+'"'):" "+t+"='"+e.replace(/'/g,"&#39;")+"'"}
function pug_escape(e){var a=""+e,t=pug_match_html.exec(a);if(!t)return e;var r,c,n,s="";for(r=t.index,c=0;r<a.length;r++){switch(a.charCodeAt(r)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}c!==r&&(s+=a.substring(c,r)),c=r+1,s+=n}return c!==r?s+a.substring(c,r):s}
var pug_match_html=/["&<>]/;function template(locals) {var pug_html = "", pug_mixins = {}, pug_interp;pug_html = pug_html + "\u003Cdiv class=\"ldcv\"\u003E\u003Cdiv class=\"base\"\u003E\u003Cdiv class=\"inner position-relative\"\u003E\u003Cscript type=\"@plotdb\u002Fblock\"\u003Emodule.exports={interface:function(){var t=this;return{get:function(){t.itf.start();return t.ldcv.get()},set:function(e){t.itf.stop();return t.ldcv.set(e)}}},init:function(e){var o,a=this;o=e.root;return servebase.corectx(function(e){var n,t,r,i;n=e.core;t=new BarcodeDetector({formats:[\"isbn_13\"]});a.ldcv=new ldcover({root:o});a.cache={};a.info={};r=new ldview({root:o,text:{isbn:function(e){var t,n;t=e.node;n=(a.info||{}).isbn||\"\";return!n?n:\"ISBN: \"+n},title:function(e){var t;t=e.node;return(a.info||{}).title||a.value||\"\"}},action:{click:{manual:function(e){var t;t=e.node;return n.ldcvmgr.get({ns:\"local\",name:\"new-book\"},{isbn:a.value}).then(function(){return a.ldcv.set()})},get:function(e){var t;t=e.node;a.itf.stop();return a.ldcv.set(a.cache[a.value])}}},handler:{info:function(e){var t;t=e.node;return t.classList.toggle(\"d-none\",!a.value)}}});i=r.get(\"video\");a.time={_fps_delay:200};return a.itf={stop:function(){return Promise.resolve().then(function(){var e,t,n,r,i=[];a.running=false;if(!a.mediastream){return}if(!(e=a.mediastream.getTracks())){return}for(t=0,n=e.length;t\u003Cn;++t){r=t;i.push(e[r].stop())}return i})},start:function(){return a.itf.stop().then(function(){a.running=true;return a.itf.prepare().then(function(){return requestAnimationFrame(function(e){return a.itf.handler(e,true)})})})},handler:function(e,t){var n,r;t==null&&(t=false);if(!a.running){return}a.time.now=e;n=a.time.isThrottled?(r=a.time._fps_delay)\u003E1e3?r:1e3:a.time._fps_delay;if(t||a.time.now-a.time.last\u003E=n){a.time.last=e;a.itf.render()}return requestAnimationFrame(function(e){return a.itf.handler(e,false)})},render:function(){if(!a.running){return}return t.detect(i).then(function(e){e.forEach(function(e){return a.value=e.rawValue});if(a.value&&\u002F^\\d+$\u002F.exec(a.value+\"\")){Promise.resolve().then(function(){if(a.cache[a.value]){return a.cache[a.value]}return function(r){return a.cache[r]=Promise.resolve().then(function(){return ld$.fetch(\"\u002Fapi\u002Fbook\",{method:\"POST\"},{json:{list:[r]},type:\"json\"}).then(function(e){var t,n;e==null&&(e=[]);t=e.filter(function(e){return e.isbn===r})[0];a.cache[r]=n=!t?{}:t;if(r!==a.value){return lderror.reject(999)}return n})})}(a.value)}).then(function(e){a.info=e;return r.render([\"isbn\",\"info\",\"title\"])})[\"catch\"](function(e){if(lderror.id(e)===999){}else{return Promise.reject(e)}})}return r.render([\"isbn\",\"info\",\"title\"])})},prepare:function(){var e,t,n,r=this;e=o.querySelector(\".base\").getBoundingClientRect();t=window.matchMedia(\"(orientation: portrait)\").matches?e.height\u002Fe.width:e.width\u002Fe.height;n={video:{width:2e3,height:2e3,facingMode:\"environment\",aspectRatio:{exact:t}}};return navigator.mediaDevices.getUserMedia(n).then(function(n){r.mediastream=n;return new Promise(function(e,t){i.addEventListener(\"loadedmetadata\",function(){if(i.readyState===4){return e()}});i.srcObject=n;return i.autoplay=true})})},prepareMobile:function(){var e=this;return navigator.mediaDevices.getUserMedia({video:true}).then(function(a){return navigator.mediaDevices.enumerateDevices().then(function(e){var t,n,r,i,o;t={};if(e.length\u003E0){t.front=t.back=e[0].deviceId}Array.from(e).forEach(function(e){if(e.kind!==\"videoinput\"||!e.label){return}if(\u002F後置|back\u002F.exec(e.label.toLowerCase())){t.back=e.deviceId}if(\u002F前置|front\u002F.exec(e.label.toLowerCase())){return t.front=e.deviceId}});if(n=a.getTracks()){for(r=0,i=n.length;r\u003Ci;++r){o=r;n[o].stop()}}return navigator.mediaDevices.getUserMedia({video:true,deviceId:{exact:t.back}})})}).then(function(n){e.mediastream=n;return new Promise(function(e,t){i.addEventListener(\"loadedmetadata\",function(){if(i.readyState===4){return e()}});i.srcObject=n;return i.autoplay=true})})}}})}};\u003C\u002Fscript\u003E\u003Cstyle type=\"text\u002Fcss\"\u003E.base{width:800px;max-width:90%;height:600px;max-height:90%}[ld=info]{position:absolute;bottom:1em;right:1em;background:#fff;border-radius:.25em;background:#fff;padding:.5em}[ld=close]{position:absolute;top:.25em;right:.5em;cursor:pointer}video{width:100%;height:100%}\u003C\u002Fstyle\u003E\u003Cvideo" + (" ld=\"video\""+pug_attr("autoplay", true, true, true)+pug_attr("playsinline", true, true, true)) + "\u003E\u003C\u002Fvideo\u003E\u003Cdiv class=\"text-lg\" ld=\"close\" data-ldcv-set=\"\"\u003E\u003Ci class=\"i-close\"\u003E\u003C\u002Fi\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=\"d-none\" ld=\"info\"\u003E\u003Cdiv class=\"text-sm\" ld=\"isbn\"\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=\"btn-group mr-1\"\u003E\u003Cdiv class=\"btn btn-outline-secondary\" ld=\"title\"\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=\"btn btn-primary\" ld=\"get\"\u003E確定\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=\"btn btn-primary\" ld=\"manual\"\u003E手動\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E";;return pug_html;}; module.exports = template; })() 