(function(){ldc.register("navtop",["core"],function(arg$){var core,obj;core=arg$.core;obj={toggled:true,toggle:function(v){this.toggled=!!v;if(this.view){return this.view.render()}}};core.init().then(function(){return function(it){return it.apply(obj)}(function(){var auth,navtop,view,bar,dotst,tstTgt,that,this$=this;auth=core.auth;this.user=core.user;this.global=core.global;if(!(navtop=ld$.find('[ld-scope="@servebase/navtop"]',0))){return}this.update=function(g){var p;p=g?Promise.resolve(g):auth.get();return p.then(function(g){this$.global=g;this$.user=g.user||{};return view.render()})};auth.on("update",function(g){return this$.update(g)});this.view=view=new ldview({root:navtop,action:{click:{signup:function(){return auth.prompt({tab:"signup"}).then(function(){return this$.update()})},login:function(){return auth.prompt({tab:"login"}).then(function(){return this$.update()})},logout:function(){return auth.logout().then(function(){return this$.update()})},"set-lng":function(arg$){var node,views;node=arg$.node,views=arg$.views;core.i18n.changeLanguage(node.getAttribute("data-name"));return views[0].render("lng")}}},init:{t:function(arg$){var node;node=arg$.node;node.setAttribute("t",node.textContent);return node.innerText=""}},text:{displayname:function(){return this$.user.displayname||"User"},username:function(){return this$.user.username||"n/a"},lng:function(){var lng;if(!core.i18n){return}lng=core.i18n.language;return view.getAll("set-lng").filter(function(n){return(lng||"").toLowerCase()===(n.getAttribute("data-name")||"").toLowerCase()}).map(function(n){return n.getAttribute("data-alias")||n.innerText.trim()})[0]||lng},t:function(arg$){var node;node=arg$.node;return core.i18n?core.i18n.t("@servebase/navtop:"+(node.getAttribute("t")||"")):""}},handler:{"@":function(arg$){var node;node=arg$.node;return node.style.display=this$.toggled?"block":"none"},admin:function(arg$){var node;node=arg$.node;return node.classList.toggle("d-none",!this$.user.staff)},unauthed:function(arg$){var node;node=arg$.node;return node.classList.toggle("d-none",!!this$.user.key)},authed:function(arg$){var node;node=arg$.node;return node.classList.toggle("d-none",!this$.user.key)},avatar:function(arg$){var node;node=arg$.node;return node.style.backgroundImage="url(/assets/avatar/"+this$.user.key+")"}}});if(core.i18n){core.i18n.on("languageChanged",function(){return view.render("lng","t")})}if(!(bar=view.get("root"))){return{}}dotst=(bar.getAttribute("data-classes")||"").split(";").map(function(it){return it.split(" ").filter(function(it){return it})});tstTgt=(that=bar.getAttribute("data-pivot"))?ld$.find(document,that,0):null;if(!(dotst.length&&tstTgt)){return}new IntersectionObserver(function(it){var n;if(!(n=it[0])){return}return(n.isIntersecting?[1,0]:[0,1]).forEach(function(d,i){return dotst[d].map(function(c){return bar.classList.toggle(c,i!==0)})})},{threshold:.1}).observe(tstTgt);return{}})});return obj})}).call(this);
